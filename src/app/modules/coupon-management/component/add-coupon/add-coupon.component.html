<div class="es-modal add-edit-modal coupon-form" *ngIf="!inProgress; else spinner">

  <div class="modal-header-flex">
      <div class="modal-header-text-container">
          <div class="mb-3 subscription-header-icon">
            <svg class="add-plan" class="m-auto" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8.75 13.5C8.75 13.0858 9.08579 12.75 9.5 12.75H11.25V11C11.25 10.5858 11.5858 10.25 12 10.25C12.4142 10.25 12.75 10.5858 12.75 11V12.75H14.5C14.9142 12.75 15.25 13.0858 15.25 13.5C15.25 13.9142 14.9142 14.25 14.5 14.25H12.75V16C12.75 16.4142 12.4142 16.75 12 16.75C11.5858 16.75 11.25 16.4142 11.25 16V14.25H9.5C9.08579 14.25 8.75 13.9142 8.75 13.5Z" fill="black"/>
              <path fill-rule="evenodd" clip-rule="evenodd" d="M21.1612 9.74679C21.558 12.233 21.5296 14.7686 21.077 17.2453C20.8747 18.353 19.9483 19.1833 18.8252 19.2636L17.1873 19.3808C13.7334 19.6279 10.2664 19.6279 6.81252 19.3808L5.29851 19.2725C4.10249 19.1869 3.11598 18.3027 2.90046 17.1232C2.46379 14.7333 2.38904 12.2913 2.6787 9.87915L2.95118 7.61004C3.11289 6.26343 4.25529 5.25 5.61158 5.25H7.90314C9.0209 5.25 9.95217 6.04846 10.1577 7.10612H18.4721C19.7785 7.10612 20.8912 8.05533 21.0971 9.34535L21.1612 9.74679ZM19.6015 16.9757C20.0235 14.6662 20.05 12.3017 19.6799 9.98322L19.6158 9.58178C19.5261 9.0197 19.0413 8.60612 18.4721 8.60612H9.75927C9.1742 8.60612 8.69991 8.13183 8.69991 7.54677C8.69991 7.10672 8.34319 6.75 7.90314 6.75H5.61158C5.01455 6.75 4.51167 7.19611 4.44048 7.78888L4.168 10.058C3.89627 12.3208 3.9664 14.6116 4.37603 16.8536C4.46856 17.36 4.89208 17.7396 5.40556 17.7763L6.91956 17.8846C10.3021 18.1266 13.6977 18.1266 17.0803 17.8846L18.7181 17.7674C19.1587 17.7359 19.5221 17.4102 19.6015 16.9757Z" fill="black"/>
            </svg>
          </div>  
      </div>
      <div class="es-btn-close-container mt-0 mb-auto me-3">
          <a class="es-btn-close" (click)="close()"></a>
      </div>
  </div>
  
  <div>
      <p class="modal-header-text mb-0">Add New Coupon</p>
      <p class="modal-sub-header-text mb-0 mt-2">Add a new coupon according to your liking.</p>
  </div>
  <div class="es-modal-body">
      
      <!-- <div class="steps">
        <div class="active">
          <span *ngIf="currentStep == 1; else tick">1</span>
          <ng-template #tick>
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M13.1818 4.00049L6.18182 11.0005L3 7.81867" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </ng-template>
        </div>
        <span class="line" [ngClass]="{'active': currentStep == 2 || currentStep == 3 }"></span>
        
        <div [ngClass]="{'active': currentStep == 2 || currentStep == 3 }">
          <span *ngIf="currentStep == 1 || currentStep == 2; else tick">2</span>
          <ng-template #tick>
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M13.1818 4.00049L6.18182 11.0005L3 7.81867" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </ng-template>
        </div>
        <span class="line" [ngClass]="{'active': currentStep == 3 }"></span>

        <div [ngClass]="{'active': currentStep == 3 }">3</div>
      </div>  -->
    
 
      <div class="steps">
        <ng-container *ngFor="let step of stepCountArray; let last = last">
          <div [ngClass]="{'active': currentStep >= step }">
            <span *ngIf="currentStep <= step; else tick">{{ step }}</span>
            <ng-template #tick>
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M13.1818 4.00049L6.18182 11.0005L3 7.81867" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </ng-template>
          </div>
          <span class="line" *ngIf="!last" [ngClass]="{'active': currentStep > step }"></span>
        </ng-container>
      </div>

      <form class="es-modal-form" [formGroup]="couponForm" novalidate autocomplete="off">
        <!-- STEP ONE - Start -->
        <div formGroupName="stepOne" *ngIf="currentStep == 1">
          <div class="div-height">
              <label for="code" class="form-label es-modal-form-label">Coupon Code*</label>
              <input type="text" class="form-control es-input" id="code" aria-describedby="code" name="code" formControlName="code" placeholder="Set Coupon Code" [ngClass]="{'border-purple': couponForm.controls.stepOne.controls.code.valid, 'border-error': couponForm.controls.stepOne.controls.code.touched && couponForm.controls.stepOne.controls.code.errors?.['required']}">
              <div>
                <span class="help-block ng-invalid text-danger" *ngIf="(couponForm.controls.stepOne.controls.code.touched || couponForm.controls.stepOne.controls.code.dirty)">
                    <span class="small" *ngIf="couponForm.controls.stepOne.controls.code.errors?.['required']">
                        Please set a coupon code
                    </span>
                </span>
              </div>
          </div>
          <div class="h-auto">
              <div>
                <div class="mb-2">
                  <span class="form-label es-modal-form-label">Discount Type*</span>
                </div>
                <div class="d-flex justify-content-between">
                  <div class="form-check custom-radio-div" [ngClass]="{'checked': couponForm.controls.stepOne.controls.discountType.value == 'fixed'}">
                    <label for="fixed" class="w90">Fix Price</label>
                    <input type="radio" name="discountType" id="fixed" formControlName="discountType" value="fixed" (change)="onRadioButtonChange('fixed')">
                  </div>
                  <div class="form-check custom-radio-div" [ngClass]="{'checked': couponForm.controls.stepOne.controls.discountType.value == 'percentage'}">
                    <label for="percentage" class="w90">Percentage</label>
                    <input type="radio" name="discountType" id="percentage" formControlName="discountType" value="percentage"  (change)="onRadioButtonChange('percentage')">
                  </div>
                </div>
              </div>
              <div class="d-flex justify-content-between discount-value mt-3">
                <div class="w-100 div-height">
                  <div class="d-flex relative">
                      <input type="text" class="form-control es-input price-input number-input-right-padding" id="discount-value" aria-describedby="discount-value" name="discountValue" formControlName="discountValue" appNumberOnly [ngClass]="{'border-purple': couponForm.controls.stepOne.controls.discountValue.valid, 'border-error': couponForm.controls.stepOne.controls.discountValue.touched && (couponForm.controls.stepOne.controls.discountValue.errors?.['required'] || couponForm.controls.stepOne.controls.discountValue.errors?.['min'])}">
                      <span class="form-label es-modal-form-label price-input-icon" [ngStyle]="{'border-right-color': couponForm.controls.stepOne.controls.discountValue.touched && (couponForm.controls.stepOne.controls.discountValue.errors?.['required'] || couponForm.controls.stepOne.controls.discountValue.errors?.['min']) ? 'rgb(234,155,155)' : ''}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 22 22" fill="none" *ngIf="couponForm.controls?.stepOne?.controls?.discountType?.value == 'fixed'; else percentage">
                          <mask id="mask0_464_18026" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="22" height="22">
                            <rect width="22" height="22" fill="#D9D9D9"/>
                          </mask>
                          <g mask="url(#mask0_464_18026)">
                            <path d="M10.1055 19.25V17.2792C9.29581 17.0958 8.59701 16.7444 8.00912 16.225C7.42062 15.7056 6.98887 14.9722 6.71387 14.025L8.4097 13.3375C8.63887 14.0708 8.97895 14.6285 9.42995 15.0104C9.88034 15.3924 10.4722 15.5833 11.2055 15.5833C11.8319 15.5833 12.363 15.4422 12.7987 15.1598C13.2338 14.8769 13.4514 14.4375 13.4514 13.8417C13.4514 13.3069 13.2833 12.8828 12.9472 12.5693C12.6111 12.2564 11.8319 11.9014 10.6097 11.5042C9.29581 11.0917 8.39442 10.5991 7.90553 10.0265C7.41665 9.45328 7.1722 8.75417 7.1722 7.92917C7.1722 6.93611 7.49303 6.16458 8.1347 5.61458C8.77637 5.06458 9.43331 4.75139 10.1055 4.675V2.75H11.9389V4.675C12.7028 4.79722 13.3331 5.07589 13.83 5.511C14.3262 5.94672 14.6889 6.47778 14.918 7.10417L13.2222 7.8375C13.0389 7.34861 12.7791 6.98194 12.443 6.7375C12.1069 6.49306 11.6486 6.37083 11.068 6.37083C10.3958 6.37083 9.88401 6.51994 9.53262 6.81817C9.18123 7.11578 9.00553 7.48611 9.00553 7.92917C9.00553 8.43333 9.2347 8.83056 9.69303 9.12083C10.1514 9.41111 10.9458 9.71667 12.0764 10.0375C13.1305 10.3431 13.929 10.828 14.4716 11.4922C15.0137 12.1571 15.2847 12.925 15.2847 13.7958C15.2847 14.8806 14.9639 15.7056 14.3222 16.2708C13.6805 16.8361 12.8861 17.1875 11.9389 17.325V19.25H10.1055Z" fill="#475467"/>
                          </g>
                        </svg>

                        <ng-template #percentage>
                          <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M5.09668 1.62793C5.58919 2.18685 5.83545 2.94222 5.83545 3.89404C5.83545 4.84587 5.58919 5.60124 5.09668 6.16016C4.6097 6.71908 3.94564 6.99854 3.10449 6.99854C2.26888 6.99854 1.60482 6.71908 1.1123 6.16016C0.619792 5.60124 0.373535 4.84587 0.373535 3.89404C0.373535 2.94222 0.619792 2.18685 1.1123 1.62793C1.60482 1.06901 2.26888 0.789551 3.10449 0.789551C3.9401 0.789551 4.60417 1.06901 5.09668 1.62793ZM2.46533 5.09766C2.62028 5.38542 2.83333 5.5293 3.10449 5.5293C3.37565 5.5293 3.5887 5.38542 3.74365 5.09766C3.8986 4.80436 3.97607 4.40039 3.97607 3.88574C3.97607 3.37109 3.8986 2.96712 3.74365 2.67383C3.5887 2.38053 3.37565 2.23389 3.10449 2.23389C2.83333 2.23389 2.62028 2.38053 2.46533 2.67383C2.31038 2.96712 2.23291 3.37109 2.23291 3.88574C2.23291 4.40039 2.31038 4.80436 2.46533 5.09766ZM3.56934 13H1.56055L6.20898 6.6333L10.3013 1.02197H12.3018L7.78613 7.21436L3.56934 13ZM13.4888 10.0615C13.4888 11.0189 13.2425 11.777 12.75 12.3359C12.2575 12.8949 11.5934 13.1743 10.7578 13.1743C9.9222 13.1743 9.25814 12.8949 8.76562 12.3359C8.27311 11.7715 8.02686 11.0133 8.02686 10.0615C8.02686 9.1097 8.27311 8.35433 8.76562 7.79541C9.25814 7.23649 9.9222 6.95703 10.7578 6.95703C11.5934 6.95703 12.2575 7.23649 12.75 7.79541C13.2425 8.35433 13.4888 9.1097 13.4888 10.0615ZM10.1187 11.2651C10.2736 11.5529 10.4867 11.6968 10.7578 11.6968C11.029 11.6968 11.242 11.5529 11.397 11.2651C11.5519 10.9718 11.6294 10.5679 11.6294 10.0532C11.6294 9.53857 11.5519 9.1346 11.397 8.84131C11.242 8.54801 11.029 8.40137 10.7578 8.40137C10.4867 8.40137 10.2736 8.54801 10.1187 8.84131C9.9637 9.1346 9.88623 9.53857 9.88623 10.0532C9.88623 10.5679 9.9637 10.9718 10.1187 11.2651Z" fill="#475467"/>
                          </svg>  
                        </ng-template>
                      </span>
                  </div>
                  <div class="input-number-btn">
                    <span class="number-decremental" (click)="updateValue('priceBundle', 'dec')"> - </span>
                    <span class="number-incremental" (click)="updateValue('priceBundle', 'inc')"> + </span>
                  </div>
                  <div class="mt-2">
                    <span class="help-block ng-invalid text-danger" *ngIf="(couponForm.controls.stepOne.controls.discountValue.touched || couponForm.controls.stepOne.controls.discountValue.dirty)">
                        <span class="small" *ngIf="couponForm.controls.stepOne.controls.discountValue.errors?.['required'] || couponForm.controls.stepOne.controls.discountValue.errors?.['min']">
                            Fix price {{ couponForm.controls.stepOne.controls.discountType.value == 'fixed' ? 'value' : 'percentage' }} is invalid, please check the details and try again.
                        </span>
                    </span>
                  </div>
                </div>
              </div>
          </div>
        </div>
        <!-- STEP ONE - End -->

        <!-- STEP TWO - Start -->
        <div formGroupName="stepTwo" *ngIf="currentStep == 2">
          <div>
            <div class="d-flex justify-content-between">
              <div class="input-width">
                  <label for="startDate" class="form-label es-modal-form-label">Start Date*</label>
                  <div class="d-flex input-icon">
                    <mat-form-field appearance="outline" [ngClass]="{'border-purple': couponForm.controls.stepTwo.controls.startDate.valid && !isDateError, 'border-error': isDateError}">
                        <input matInput [matDatepicker]="startDate" formControlName="startDate" placeholder="DD-MM-YYYY" (click)="startDate.open()" [min]="currentDate">
                        <mat-datepicker-toggle matIconSuffix [for]="startDate">
                          <mat-icon matDatepickerToggleIcon>
                            <svg width="15" height="16" viewBox="0 0 15 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path class="calendar-fill-color" d="M7.2 9.6C6.97333 9.6 6.78347 9.5232 6.6304 9.3696C6.4768 9.21653 6.4 9.02667 6.4 8.8C6.4 8.57333 6.4768 8.3832 6.6304 8.2296C6.78347 8.07653 6.97333 8 7.2 8C7.42667 8 7.6168 8.07653 7.7704 8.2296C7.92347 8.3832 8 8.57333 8 8.8C8 9.02667 7.92347 9.21653 7.7704 9.3696C7.6168 9.5232 7.42667 9.6 7.2 9.6ZM4 9.6C3.77333 9.6 3.5832 9.5232 3.4296 9.3696C3.27653 9.21653 3.2 9.02667 3.2 8.8C3.2 8.57333 3.27653 8.3832 3.4296 8.2296C3.5832 8.07653 3.77333 8 4 8C4.22667 8 4.4168 8.07653 4.5704 8.2296C4.72347 8.3832 4.8 8.57333 4.8 8.8C4.8 9.02667 4.72347 9.21653 4.5704 9.3696C4.4168 9.5232 4.22667 9.6 4 9.6ZM10.4 9.6C10.1733 9.6 9.98347 9.5232 9.8304 9.3696C9.6768 9.21653 9.6 9.02667 9.6 8.8C9.6 8.57333 9.6768 8.3832 9.8304 8.2296C9.98347 8.07653 10.1733 8 10.4 8C10.6267 8 10.8165 8.07653 10.9696 8.2296C11.1232 8.3832 11.2 8.57333 11.2 8.8C11.2 9.02667 11.1232 9.21653 10.9696 9.3696C10.8165 9.5232 10.6267 9.6 10.4 9.6ZM7.2 12.8C6.97333 12.8 6.78347 12.7232 6.6304 12.5696C6.4768 12.4165 6.4 12.2267 6.4 12C6.4 11.7733 6.4768 11.5835 6.6304 11.4304C6.78347 11.2768 6.97333 11.2 7.2 11.2C7.42667 11.2 7.6168 11.2768 7.7704 11.4304C7.92347 11.5835 8 11.7733 8 12C8 12.2267 7.92347 12.4165 7.7704 12.5696C7.6168 12.7232 7.42667 12.8 7.2 12.8ZM4 12.8C3.77333 12.8 3.5832 12.7232 3.4296 12.5696C3.27653 12.4165 3.2 12.2267 3.2 12C3.2 11.7733 3.27653 11.5835 3.4296 11.4304C3.5832 11.2768 3.77333 11.2 4 11.2C4.22667 11.2 4.4168 11.2768 4.5704 11.4304C4.72347 11.5835 4.8 11.7733 4.8 12C4.8 12.2267 4.72347 12.4165 4.5704 12.5696C4.4168 12.7232 4.22667 12.8 4 12.8ZM10.4 12.8C10.1733 12.8 9.98347 12.7232 9.8304 12.5696C9.6768 12.4165 9.6 12.2267 9.6 12C9.6 11.7733 9.6768 11.5835 9.8304 11.4304C9.98347 11.2768 10.1733 11.2 10.4 11.2C10.6267 11.2 10.8165 11.2768 10.9696 11.4304C11.1232 11.5835 11.2 11.7733 11.2 12C11.2 12.2267 11.1232 12.4165 10.9696 12.5696C10.8165 12.7232 10.6267 12.8 10.4 12.8ZM1.6 16C1.16 16 0.7832 15.8435 0.4696 15.5304C0.156533 15.2168 0 14.84 0 14.4V3.2C0 2.76 0.156533 2.38347 0.4696 2.0704C0.7832 1.7568 1.16 1.6 1.6 1.6H2.4V0H4V1.6H10.4V0H12V1.6H12.8C13.24 1.6 13.6168 1.7568 13.9304 2.0704C14.2435 2.38347 14.4 2.76 14.4 3.2V14.4C14.4 14.84 14.2435 15.2168 13.9304 15.5304C13.6168 15.8435 13.24 16 12.8 16H1.6ZM1.6 14.4H12.8V6.4H1.6V14.4Z" fill="#475467"/>
                            </svg>
                          </mat-icon>
                        </mat-datepicker-toggle>
                        <mat-datepicker #startDate></mat-datepicker>
                    </mat-form-field>
                  </div>
              </div>
              
              <div class="input-width">
                  <label for="endDate" class="form-label es-modal-form-label">End Date*</label>
                  <div class="d-flex input-icon">
                    <mat-form-field appearance="outline" [ngClass]="{'border-purple': couponForm.controls.stepTwo.controls.endDate.valid && !isDateError, 'border-error': isDateError}">
                        <input matInput [matDatepicker]="endDate" formControlName="endDate" placeholder="DD-MM-YYYY" (click)="endDate.open()" [min]="couponForm.controls.stepTwo.controls.startDate.value" #matDatePickerEle>
                        <mat-datepicker-toggle matIconSuffix [for]="endDate">
                          <mat-icon matDatepickerToggleIcon>
                            <svg width="15" height="16" viewBox="0 0 15 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path class="calendar-fill-color" d="M7.2 9.6C6.97333 9.6 6.78347 9.5232 6.6304 9.3696C6.4768 9.21653 6.4 9.02667 6.4 8.8C6.4 8.57333 6.4768 8.3832 6.6304 8.2296C6.78347 8.07653 6.97333 8 7.2 8C7.42667 8 7.6168 8.07653 7.7704 8.2296C7.92347 8.3832 8 8.57333 8 8.8C8 9.02667 7.92347 9.21653 7.7704 9.3696C7.6168 9.5232 7.42667 9.6 7.2 9.6ZM4 9.6C3.77333 9.6 3.5832 9.5232 3.4296 9.3696C3.27653 9.21653 3.2 9.02667 3.2 8.8C3.2 8.57333 3.27653 8.3832 3.4296 8.2296C3.5832 8.07653 3.77333 8 4 8C4.22667 8 4.4168 8.07653 4.5704 8.2296C4.72347 8.3832 4.8 8.57333 4.8 8.8C4.8 9.02667 4.72347 9.21653 4.5704 9.3696C4.4168 9.5232 4.22667 9.6 4 9.6ZM10.4 9.6C10.1733 9.6 9.98347 9.5232 9.8304 9.3696C9.6768 9.21653 9.6 9.02667 9.6 8.8C9.6 8.57333 9.6768 8.3832 9.8304 8.2296C9.98347 8.07653 10.1733 8 10.4 8C10.6267 8 10.8165 8.07653 10.9696 8.2296C11.1232 8.3832 11.2 8.57333 11.2 8.8C11.2 9.02667 11.1232 9.21653 10.9696 9.3696C10.8165 9.5232 10.6267 9.6 10.4 9.6ZM7.2 12.8C6.97333 12.8 6.78347 12.7232 6.6304 12.5696C6.4768 12.4165 6.4 12.2267 6.4 12C6.4 11.7733 6.4768 11.5835 6.6304 11.4304C6.78347 11.2768 6.97333 11.2 7.2 11.2C7.42667 11.2 7.6168 11.2768 7.7704 11.4304C7.92347 11.5835 8 11.7733 8 12C8 12.2267 7.92347 12.4165 7.7704 12.5696C7.6168 12.7232 7.42667 12.8 7.2 12.8ZM4 12.8C3.77333 12.8 3.5832 12.7232 3.4296 12.5696C3.27653 12.4165 3.2 12.2267 3.2 12C3.2 11.7733 3.27653 11.5835 3.4296 11.4304C3.5832 11.2768 3.77333 11.2 4 11.2C4.22667 11.2 4.4168 11.2768 4.5704 11.4304C4.72347 11.5835 4.8 11.7733 4.8 12C4.8 12.2267 4.72347 12.4165 4.5704 12.5696C4.4168 12.7232 4.22667 12.8 4 12.8ZM10.4 12.8C10.1733 12.8 9.98347 12.7232 9.8304 12.5696C9.6768 12.4165 9.6 12.2267 9.6 12C9.6 11.7733 9.6768 11.5835 9.8304 11.4304C9.98347 11.2768 10.1733 11.2 10.4 11.2C10.6267 11.2 10.8165 11.2768 10.9696 11.4304C11.1232 11.5835 11.2 11.7733 11.2 12C11.2 12.2267 11.1232 12.4165 10.9696 12.5696C10.8165 12.7232 10.6267 12.8 10.4 12.8ZM1.6 16C1.16 16 0.7832 15.8435 0.4696 15.5304C0.156533 15.2168 0 14.84 0 14.4V3.2C0 2.76 0.156533 2.38347 0.4696 2.0704C0.7832 1.7568 1.16 1.6 1.6 1.6H2.4V0H4V1.6H10.4V0H12V1.6H12.8C13.24 1.6 13.6168 1.7568 13.9304 2.0704C14.2435 2.38347 14.4 2.76 14.4 3.2V14.4C14.4 14.84 14.2435 15.2168 13.9304 15.5304C13.6168 15.8435 13.24 16 12.8 16H1.6ZM1.6 14.4H12.8V6.4H1.6V14.4Z" fill="#475467"/>
                            </svg>
                          </mat-icon>
                        </mat-datepicker-toggle>
                        <mat-datepicker #endDate></mat-datepicker>
                    </mat-form-field>
                  </div>
              </div>
            </div>

            <div *ngIf="isDateError">
              <span class="help-block ng-invalid text-danger">
                <span class="small">
                  Please set a start date and a end date
              </span>
            </span>
            </div>
          </div>
          
          <div class="d-flex justify-content-between discount-value div-height mt-2">
            <div class="w-100">
              <label for="total" class="form-label es-modal-form-label">Number of Coupon*</label>
              <div class="d-flex relative">
                  <input type="text" class="form-control es-input price-input number-input-right-padding" id="total" aria-describedby="total" formControlName="total" appNumberOnly [ngClass]="{'border-purple': couponForm.controls.stepTwo.controls.total.valid, 'border-error': couponForm.controls.stepTwo.controls.total.touched && (couponForm.controls.stepTwo.controls.total.errors?.['required'] || couponForm.controls.stepTwo.controls.total.errors?.['min'])}">
                  <span class="form-label es-modal-form-label coupon-input-icon" [ngStyle]="{'border-right-color': couponForm.controls.stepTwo.controls.total.touched && (couponForm.controls.stepTwo.controls.total.errors?.['required'] || couponForm.controls.stepTwo.controls.total.errors?.['min']) ? 'rgb(234,155,155)' : ''}">
                    <svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <g id="Group">
                        <path class="stroke-color" id="Vector" d="M11.5046 1H7.99583C4.68833 1 3.03458 1 2.00645 2.0255C1.2977 2.73075 1.07808 3.73263 1.00895 5.36538C0.995827 5.68913 0.988827 5.85188 1.0492 5.9595C1.11045 6.06713 1.35108 6.20275 1.83408 6.47225C2.10614 6.62393 2.33277 6.84551 2.49054 7.11409C2.64831 7.38267 2.73149 7.68851 2.73149 8C2.73149 8.31149 2.64831 8.61733 2.49054 8.88591C2.33277 9.15449 2.10614 9.37607 1.83408 9.52775C1.35108 9.79813 1.10958 9.93287 1.0492 10.0405C0.988827 10.1481 0.995827 10.31 1.00983 10.6338C1.07808 12.2674 1.29858 13.2692 2.00645 13.9745C3.0337 15 4.68745 15 7.99583 15H11.5046C14.8121 15 16.4658 15 17.494 13.9745C18.2027 13.2692 18.4223 12.2674 18.4915 10.6346C18.5046 10.3109 18.5116 10.1481 18.4512 10.0405C18.39 9.93287 18.1493 9.79813 17.6663 9.52775C17.3943 9.37607 17.1676 9.15449 17.0099 8.88591C16.8521 8.61733 16.7689 8.31149 16.7689 8C16.7689 7.68851 16.8521 7.38267 17.0099 7.11409C17.1676 6.84551 17.3943 6.62393 17.6663 6.47225C18.1493 6.20275 18.3908 6.06713 18.4512 5.9595C18.5116 5.85188 18.5046 5.69 18.4906 5.36538C18.4223 3.73263 18.2018 2.73162 17.494 2.0255C16.4667 1 14.813 1 11.5046 1Z" stroke="black" stroke-width="1.5"/>
                        <path class="stroke-color" id="Vector_2" d="M7.12524 10.625L12.3752 5.375" stroke="black" stroke-width="1.5" stroke-linecap="round"/>
                        <path class="fill-color" id="Vector_3" d="M12.8127 10.1875C12.8127 10.4196 12.7206 10.6421 12.5565 10.8062C12.3924 10.9703 12.1698 11.0625 11.9377 11.0625C11.7057 11.0625 11.4831 10.9703 11.319 10.8062C11.1549 10.6421 11.0627 10.4196 11.0627 10.1875C11.0627 9.95544 11.1549 9.73288 11.319 9.56878C11.4831 9.40469 11.7057 9.3125 11.9377 9.3125C12.1698 9.3125 12.3924 9.40469 12.5565 9.56878C12.7206 9.73288 12.8127 9.95544 12.8127 10.1875ZM8.43774 5.8125C8.43774 6.04456 8.34556 6.26712 8.18146 6.43122C8.01737 6.59531 7.79481 6.6875 7.56274 6.6875C7.33068 6.6875 7.10812 6.59531 6.94403 6.43122C6.77993 6.26712 6.68774 6.04456 6.68774 5.8125C6.68774 5.58044 6.77993 5.35788 6.94403 5.19378C7.10812 5.02969 7.33068 4.9375 7.56274 4.9375C7.79481 4.9375 8.01737 5.02969 8.18146 5.19378C8.34556 5.35788 8.43774 5.58044 8.43774 5.8125Z" fill="black"/>
                      </g>
                    </svg>
                  </span>
              </div>
              <div class="input-number-btn">
                  <span class="number-decremental"> - </span>
                  <span class="number-incremental"> + </span>
              </div>
              <div class="mt-2">
                <span class="help-block ng-invalid text-danger" *ngIf="(couponForm.controls.stepTwo.controls.total.touched || couponForm.controls.stepTwo.controls.total.dirty)">
                    <span class="small" *ngIf="couponForm.controls.stepTwo.controls.total.errors?.['required'] || couponForm.controls.stepTwo.controls.total.errors?.['min']">
                        No. of coupon entered is invalid, please check the details and try again.
                    </span>
                </span>
              </div>
            </div>
          </div>

          <div class="div-height mb-2">
            <div class="d-flex justify-content-between">
              <div class="input-width">
                <label for="minPurchaseValue" class="form-label es-modal-form-label">Minimum Purchase Value</label>
                <div class="d-flex relative">
                    <input type="text" class="form-control es-input price-input number-input-right-padding" id="minPurchaseValue" aria-describedby="minPurchaseValue" formControlName="minPurchaseValue" appNumberOnly>
                    <span class="form-label es-modal-form-label price-input-icon">
                      <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <mask id="mask0_464_18397" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="22" height="22">
                          <rect width="22" height="22" fill="#D9D9D9"/>
                        </mask>
                        <g mask="url(#mask0_464_18397)">
                          <path d="M10.1055 19.25V17.2792C9.29581 17.0958 8.59701 16.7444 8.00912 16.225C7.42062 15.7056 6.98887 14.9722 6.71387 14.025L8.4097 13.3375C8.63887 14.0708 8.97895 14.6285 9.42995 15.0104C9.88034 15.3924 10.4722 15.5833 11.2055 15.5833C11.8319 15.5833 12.363 15.4422 12.7987 15.1598C13.2338 14.8769 13.4514 14.4375 13.4514 13.8417C13.4514 13.3069 13.2833 12.8828 12.9472 12.5693C12.6111 12.2564 11.8319 11.9014 10.6097 11.5042C9.29581 11.0917 8.39442 10.5991 7.90553 10.0265C7.41665 9.45328 7.1722 8.75417 7.1722 7.92917C7.1722 6.93611 7.49303 6.16458 8.1347 5.61458C8.77637 5.06458 9.43331 4.75139 10.1055 4.675V2.75H11.9389V4.675C12.7028 4.79722 13.3331 5.07589 13.83 5.511C14.3262 5.94672 14.6889 6.47778 14.918 7.10417L13.2222 7.8375C13.0389 7.34861 12.7791 6.98194 12.443 6.7375C12.1069 6.49306 11.6486 6.37083 11.068 6.37083C10.3958 6.37083 9.88401 6.51994 9.53262 6.81817C9.18123 7.11578 9.00553 7.48611 9.00553 7.92917C9.00553 8.43333 9.2347 8.83056 9.69303 9.12083C10.1514 9.41111 10.9458 9.71667 12.0764 10.0375C13.1305 10.3431 13.929 10.828 14.4716 11.4922C15.0137 12.1571 15.2847 12.925 15.2847 13.7958C15.2847 14.8806 14.9639 15.7056 14.3222 16.2708C13.6805 16.8361 12.8861 17.1875 11.9389 17.325V19.25H10.1055Z" fill="#475467"/>
                        </g>
                      </svg>
                    </span>
                </div>
                <div class="input-number-btn min-max-value">
                    <span class="number-decremental"> - </span>
                    <span class="number-incremental"> + </span>
                </div>
              </div>
              <div class="input-width">
                <label for="maxPurchaseValue" class="form-label es-modal-form-label">Maximum Purchase Value</label>
                <div class="d-flex relative">
                    <input type="text" class="form-control es-input price-input number-input-right-padding" id="maxPurchaseValue" aria-describedby="maxPurchaseValue" formControlName="maxPurchaseValue" appNumberOnly>
                    <span class="form-label es-modal-form-label price-input-icon">
                      <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <mask id="mask0_464_18397" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="22" height="22">
                          <rect width="22" height="22" fill="#D9D9D9"/>
                        </mask>
                        <g mask="url(#mask0_464_18397)">
                          <path d="M10.1055 19.25V17.2792C9.29581 17.0958 8.59701 16.7444 8.00912 16.225C7.42062 15.7056 6.98887 14.9722 6.71387 14.025L8.4097 13.3375C8.63887 14.0708 8.97895 14.6285 9.42995 15.0104C9.88034 15.3924 10.4722 15.5833 11.2055 15.5833C11.8319 15.5833 12.363 15.4422 12.7987 15.1598C13.2338 14.8769 13.4514 14.4375 13.4514 13.8417C13.4514 13.3069 13.2833 12.8828 12.9472 12.5693C12.6111 12.2564 11.8319 11.9014 10.6097 11.5042C9.29581 11.0917 8.39442 10.5991 7.90553 10.0265C7.41665 9.45328 7.1722 8.75417 7.1722 7.92917C7.1722 6.93611 7.49303 6.16458 8.1347 5.61458C8.77637 5.06458 9.43331 4.75139 10.1055 4.675V2.75H11.9389V4.675C12.7028 4.79722 13.3331 5.07589 13.83 5.511C14.3262 5.94672 14.6889 6.47778 14.918 7.10417L13.2222 7.8375C13.0389 7.34861 12.7791 6.98194 12.443 6.7375C12.1069 6.49306 11.6486 6.37083 11.068 6.37083C10.3958 6.37083 9.88401 6.51994 9.53262 6.81817C9.18123 7.11578 9.00553 7.48611 9.00553 7.92917C9.00553 8.43333 9.2347 8.83056 9.69303 9.12083C10.1514 9.41111 10.9458 9.71667 12.0764 10.0375C13.1305 10.3431 13.929 10.828 14.4716 11.4922C15.0137 12.1571 15.2847 12.925 15.2847 13.7958C15.2847 14.8806 14.9639 15.7056 14.3222 16.2708C13.6805 16.8361 12.8861 17.1875 11.9389 17.325V19.25H10.1055Z" fill="#475467"/>
                        </g>
                      </svg>
                    </span>
                </div>
                <div class="input-number-btn min-max-value">
                    <span class="number-decremental"> - </span>
                    <span class="number-incremental"> + </span>
                </div>
              </div>
            </div>
            <div class="mt-2">
              <span class="help-block ng-invalid text-danger" *ngIf="couponForm.controls.stepTwo.controls.minPurchaseValue.dirty &&  couponForm.controls.stepTwo.controls.maxPurchaseValue.dirty">
                  <span class="x-small">
                      Minimum or maximum purchase value is invalid, please check the details and try again.
                  </span>
              </span>
            </div>
          </div>
          <div class="div-height mt-2">
            <div>
              <label for="discount-type" class="form-label es-modal-form-label">Use Type*</label>
            </div>
            <div class="d-flex justify-content-between">
              <div class="form-check form-check-inline custom-radio-div" [ngClass]="{'checked': couponForm.controls.stepTwo.controls.useType.value == 'single'}">
                <label for="single" class="w90">One Time</label>
                <input type="radio" name="useType" id="single" formControlName="useType" value="single" (change)="onRadioButtonChange('single')">
              </div>
              <div class="form-check form-check-inline custom-radio-div" [ngClass]="{'checked': couponForm.controls.stepTwo.controls.useType.value == 'multi'}">
                <label for="multi" class="w90">Multi Use</label>
                <input type="radio" name="useType" id="multi" formControlName="useType" value="multi" (change)="onRadioButtonChange('multi')">
              </div>
            </div>
          </div>
        
          <div class="use-div" *ngIf="couponForm.controls.stepTwo.controls.useType.value == 'multi'">
            <div class="d-flex justify-content-between">
              <div class="w-100 position-relative div-height">
                <div class="mb-2">
                  <label for="totalUse">Number of Use</label>
                </div>
                <div class="d-flex position-relative">
                  <input type="text" class="form-control es-input price-input number-input-right-padding" aria-describedby="totalUse" formControlName="totalUse" (focus)="onInputFocus()" appNumberOnly>
                  <span class="es-modal-form-label number-of-use-icon">
                    <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M3 16.0002V6.00018L10 16.0002V6.00018M14 16.0002H19M14 9.00018C14 9.79583 14.2634 10.5589 14.7322 11.1215C15.2011 11.6841 15.837 12.0002 16.5 12.0002C17.163 12.0002 17.7989 11.6841 18.2678 11.1215C18.7366 10.5589 19 9.79583 19 9.00018C19 8.20453 18.7366 7.44147 18.2678 6.87886C17.7989 6.31625 17.163 6.00018 16.5 6.00018C15.837 6.00018 15.2011 6.31625 14.7322 6.87886C14.2634 7.44147 14 8.20453 14 9.00018Z" stroke="#475467" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </span>
                </div>
                <input class="position-absolute" type="radio" id="totalUse" name="totalUseType" name="totalUseType" formControlName="totalUseType" value="limited" (change)="onRadioButtonChange('limited')">
                <div class="total-use-number-button">
                    <span class="number-decremental"> - </span>
                    <span class="number-incremental"> + </span>
                </div>
                <div *ngIf="couponForm.controls.stepTwo.controls.totalUseType.value == 'limited'">
                  <span class="help-block ng-invalid text-danger" *ngIf="(couponForm.controls.stepTwo.controls.totalUse.touched || couponForm.controls.stepTwo.controls.totalUse.pristine)">
                      <span class="small text-wrap x-small" *ngIf="couponForm.controls.stepTwo.controls.totalUse.errors?.['min']">
                          No. of use entered is invalid, please check the details and try again.
                      </span>
                  </span>
                </div>
              </div>
            </div>
  
            <div class="d-flex justify-content-between">
                <div class="form-check form-check-inline custom-radio-div-block">
                  <label for="unlimited"  class="w96">Unlimited Use</label>
                  <input type="radio" name="unlimited" id="unlimited" name="totalUseType" formControlName="totalUseType" value="unlimited" (change)="onRadioButtonChange('unlimited')">
                </div>
            </div>
          </div>
        </div>
        <!-- STEP TWO - End -->

        <!-- STEP THREE - Start -->
        <div formGroupName="stepThree" *ngIf="currentStep == 3">
          <div class="d-flex justify-content-between mb-3">
            <div class="form-check custom-radio-div-inline-3" [ngClass]="{'checked': couponForm.controls.stepThree.controls.applicableType.value == 'plan'}">
              <label for="plan" class="w86">Specific Plan</label>
              <input type="radio" name="applicableType" id="plan" formControlName="applicableType" value="plan">
            </div>
            <div class="form-check custom-radio-div-inline-3" [ngClass]="{'checked': couponForm.controls.stepThree.controls.applicableType.value == 'region'}">
              <label for="region" class="w86">Region</label>
              <input type="radio" name="applicableType" id="region" formControlName="applicableType" value="region">
            </div>
            <div class="form-check custom-radio-div-inline-3" [ngClass]="{'checked': couponForm.controls.stepThree.controls.applicableType.value == 'country'}">
              <label for="country" class="w86">Country</label>
              <input type="radio" name="applicableType" id="country" formControlName="applicableType" value="country">
            </div>
          </div>
          
          <div class="dropdown-list-input">
            <div class="relative div-height">
              <ng-select 
                  [items]="list"
                  [multiple]="true"
                  [closeOnSelect]="false"
                  formControlName="applicableValue"
                  bindLabel="name"
                  bindValue="name"
                  [placeholder]="placeholderText"
                  class="full-width custom-search"
                  #ngSelectComponent>

                  <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                      <div class="ng-value" *ngFor="let item of items | slice:0:2">
                        <ng-container *ngIf="isCountry; else selectedValue">
                          <span class="ng-value-label">
                            <img [src]="$any(item).flag" class="flag-style"> 
                            <span>{{$any(item).name}}</span>
                          </span>
                          <span class="ng-value-icon right" (click)="clear(item)" aria-hidden="true">×</span>
                        </ng-container>
                        <ng-template #selectedValue>
                          <span class="ng-value-label ellipsis">{{$any(item).name}}</span>
                          <span class="ng-value-icon right" (click)="clear(item)" aria-hidden="true">×</span>
                        </ng-template>
                      </div>
                      <div class="ng-value" *ngIf="items.length > 2">
                          <span class="ng-value-label" [tooltip]="displayList(items)" placement="top" delay="100" offset="15">{{items.length - 2}} more...</span>
                      </div>
                  </ng-template>

                  <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                      <div *ngIf="isCountry; else plan">
                          <img [src]="item.flag" class="flag-style"> 
                          <span> {{item.name}} </span>
                          <span *ngIf="isCountry">{{ item.iso3code}} ({{item.dial_code}})</span>
                      </div>
                      <ng-template #plan>
                        <span class="w90 text-wrap text-break">{{item.name}}</span>
                      </ng-template>
                      <div class="form-label es-modal-form-label unlimited">
                          <input id="item-{{index}}" type="checkbox" [checked]="item$.selected" /> 
                          <span class="checkmark"></span>
                      </div>
                  </ng-template>
              </ng-select>
            </div>
          </div>
        </div>
        <!-- STEP THREE - End -->

        <div class="row gx-2 d-flex justify-content-between">
          <button class="btn btn-secondary btn-width" (click)="currentStep == 1 ? close() : previousStep()">{{ currentStep == 1 ? 'Cancel' : 'Back' }}</button>
          <button type="submit" class="btn btn-primary ms-auto btn-width" (click)="currentStep == 3 ? submit() : nextStep()" [disabled]="(currentStep == 1 && !couponForm.controls.stepOne.valid) || (currentStep == 2 && !couponForm.controls.stepTwo.valid)">{{ currentStep == 3 ? 'Submit' : 'Next' }}</button>
        </div>
      </form>
  </div>
</div>

<!-- Loading Spinner - Start -->
<ng-template #spinner class="loader-align">
  <app-loading-spinner></app-loading-spinner>
</ng-template>
<!-- Loading Spinner - End -->